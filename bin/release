#!/usr/bin/env bash
set -euox pipefail

BUILD_DIR=$1
export BUILDPACK_DIR=`dirname $(readlink -f ${BASH_SOURCE%/*})`
export GIT_CURL_VERBOSE=1
export GIT_SSL_NO_VERIFY=true
export GIT_TRACE_PERFORMANCE=true

echo "My proxies"
echo "http_proxy: "$http_proxy
echo "https_proxy: "$https_proxy
# Remove the node_modules and bower_components folders - only needed for build

if [[ -L "$BUILD_DIR/node_modules" && -d "$BUILD_DIR/node_modules" ]]; then
  rm $BUILD_DIR/node_modules
fi

if [ -d "$BUILD_DIR/node_modules" ]; then
  rm -rf $BUILD_DIR/node_modules
fi

if [[ -L "$BUILD_DIR/bower_components" && -d "$BUILD_DIR/bower_components" ]]; then
  rm $BUILD_DIR/bower_components
fi

if [ -d "$BUILD_DIR/bower_components" ]; then
  rm -rf $BUILD_DIR/bower_components
fi

# Do not use the Procfile if it is there
rm -rf $BUILD_DIR/Procfile

cat $BUILD_DIR/stratos-buildpack.yml
